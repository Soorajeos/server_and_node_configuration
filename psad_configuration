The psad tool stands for port scan attack detection is a software that actively monitors your firewall logs to determine if a scan or attack event is in progress. It can then alert administrators, or take active steps to deter the threat. Can be also used as IPS


INSTALLING PSAD ON UBUNTU

The psad intrusion detection system is available in Ubuntu’s default repositories, so it can be easily acquired through apt.

sudo apt-get update
sudo apt-get install psad


CONFIGURE IPTABLES RULES

Psad monitors iptables logs, so the iptables rules has to be configured.

Current rules can be seen by typing :-

sudo iptables -S

The output should be similar to below mentioned output.

-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT

The first rule will allow all traffic generated by our server, directed at our server. This type of connection is generally used for services to communicate with each other and pass information easily.

sudo iptables -A INPUT -i lo -j ACCEPT

The below mentioned rule explicitly allow all traffic related to an existing connection. This will allow our current sessions to continue uninterrupted.

sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT


Next, we can add the services that we wish to keep open to the public. For SSH, we can add a line like this.

sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT

If we have a web server running on the default port 80, we can add a rule like this.

sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT

Any other ports for legitimate, publicly accessible services can be set open with the same syntax.

sudo iptables -A INPUT -p <span class=“highlight”>protocol</span> –dport <span class=“highlight”>port_num</span> -j ACCEPT

The logging has to be enabled before setting the rules to drop connections.

sudo iptables -A INPUT -j LOG

We also should add this rule to the forward chain in case we end up forwarding traffic elsewhere.

sudo iptables -A FORWARD -j LOG

Rule to drop connections.

sudo iptables -A INPUT -j DROP  or  sudo iptables -P INPUT DROP


IMPORTANT NOTE


If the Iptables rules has to be flushed at any point of time, we should reverse the policy before flushing.

sudo iptables -P INPUT ACCEPT
sudo iptables -F

Failing to do that would flush all the iptables rules and only the default policy of dropping all incoming packets will remain. This will cut the ssh.

CONFIGURE PSAD TO DETECT SCANS

The configuration file for psad is located at /etc/psad/psad.conf. open it with nano

sudo nano /etc/psad/psad.conf

EMAIL_ADDRESSES             eostestdublin@gmail.com;    # The email address on which the notification email will be sent
HOSTNAME                    testserver_1;               # Host name of the server
HOME_NET                    IP/NETMAST;                 # The home network. multiple ip's can be entered with coma
ENABLE_PERSISTENCE          N;                          # Set to no as it improves performance
SCAN_TIMEOUT                3600;                       # In seconds
IPT_SYSLOG_FILE             /var/log/syslog;            # Path for the syslog file
IGNORE_PORTS                NONE;                       # The ports that needs to avoided from monitoring can be mentioned here
EMAIL_ALERT_DANGER_LEVEL    3;                          # The level on which the notification email should be sent. 1 is lowest level and 5 is highest level.
                                                        # Setting EMAIL_ALERT_DANGER_LEVEL 1 will send you tons of email. 3 or 4 is best.

The above mentioned are the important configs required to make psad up and running. Psad is highly customizable.



IMPLEMENT PSAD IDS

sudo psad --sig-update

sudo service psad restart

sudo service psad status


CHECKING THE INFO OF THE ATTACKS

sudo psad -S

 

